{% extends 'page.html.twig' %}

      {%- block main ~%}
      {#- deck ~#}
      <div id="deck" class="grow max-h-120">
        {#- card ~#}
        <div id="card" class="h-[calc(100%-var(--spacing)*6)] px-6 py-10 pb-8 rounded-3xl shadow-md bg-secondary text-white cursor-grab transition ease-out">
          <div class="flex flex-col h-full space-y-6">
            {#- card description ~#}
            <div class="flex-3/4 flex items-center">
              <div id="description" class="grow text-3xl font-bold text-center">Le sac à dos infini</div>
            </div>
            {#- card image ~#}
            <img id="image-sac" class="flex-1/4 max-h-64" src="{{ asset('images/sac-nuit.svg') }}" alt="Sac à dos">
          </div>
        </div>
        {#- fake sub-cards ~#}
        <div class="flex justify-center items-end p-4 rounded-b-2xl shadow-md bg-[#CEC9C5] relative -z-10 mx-5 -mt-25 h-28">
          <img src="{{ asset('images/sac.svg') }}" alt="Sac à dos">
        </div>
        <div class="p-4 rounded-b-xl shadow-md bg-[#9F9187] relative -z-20 mx-9 -mt-5"></div>
      </div>
      <div class="flex mt-4 text-wrap justify-center">
        {#- main button ~#}
        <button id="button" class="flex items-center space-x-4 justify-center px-14 py-5 rounded-full bg-secondary text-white no-underline cursor-pointer duration-300 ease-[cubic-bezier(0.175,0.885,0.32,1.275)] active:translate-y-1 active:scale-x-105 active:scale-y-95">
          <span><svg xmlns="http://www.w3.org/2000/svg" class="size-6.5 fill-current" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M129.9 292.5C143.2 199.5 223.3 128 320 128C373 128 421 149.5 455.8 184.2C456 184.4 456.2 184.6 456.4 184.8L464 192L416.1 192C398.4 192 384.1 206.3 384.1 224C384.1 241.7 398.4 256 416.1 256L544.1 256C561.8 256 576.1 241.7 576.1 224L576.1 96C576.1 78.3 561.8 64 544.1 64C526.4 64 512.1 78.3 512.1 96L512.1 149.4L500.8 138.7C454.5 92.6 390.5 64 320 64C191 64 84.3 159.4 66.6 283.5C64.1 301 76.2 317.2 93.7 319.7C111.2 322.2 127.4 310 129.9 292.6zM573.4 356.5C575.9 339 563.7 322.8 546.3 320.3C528.9 317.8 512.6 330 510.1 347.4C496.8 440.4 416.7 511.9 320 511.9C267 511.9 219 490.4 184.2 455.7C184 455.5 183.8 455.3 183.6 455.1L176 447.9L223.9 447.9C241.6 447.9 255.9 433.6 255.9 415.9C255.9 398.2 241.6 383.9 223.9 383.9L96 384C87.5 384 79.3 387.4 73.3 393.5C67.3 399.6 63.9 407.7 64 416.3L65 543.3C65.1 561 79.6 575.2 97.3 575C115 574.8 129.2 560.4 129 542.7L128.6 491.2L139.3 501.3C185.6 547.4 249.5 576 320 576C449 576 555.7 480.6 573.4 356.5z"/></svg></span>
          <span>Fouiller le sac</span>
        </button>
        {#- install button ~#}
        <button id="install-button" hidden title="Installer l’application" aria-label="Installer l’application" class="ml-4 flex items-center justify-center px-5 py-2 rounded-full bg-secondary text-white cursor-pointer">
          <span><svg xmlns="http://www.w3.org/2000/svg" class="size-8 fill-current" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M352 96C352 78.3 337.7 64 320 64C302.3 64 288 78.3 288 96L288 306.7L246.6 265.3C234.1 252.8 213.8 252.8 201.3 265.3C188.8 277.8 188.8 298.1 201.3 310.6L297.3 406.6C309.8 419.1 330.1 419.1 342.6 406.6L438.6 310.6C451.1 298.1 451.1 277.8 438.6 265.3C426.1 252.8 405.8 252.8 393.3 265.3L352 306.7L352 96zM160 384C124.7 384 96 412.7 96 448L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 448C544 412.7 515.3 384 480 384L433.1 384L376.5 440.6C345.3 471.8 294.6 471.8 263.4 440.6L206.9 384L160 384zM464 440C477.3 440 488 450.7 488 464C488 477.3 477.3 488 464 488C450.7 488 440 477.3 440 464C440 450.7 450.7 440 464 440z"/></svg></span>
        </button>
      </div>
      {%- endblock ~%}

    {%- block scripts ~%}
    {#- items list ~#}
    <script>
      const items = [
        {%- for item in site.data.sac ~%}
        "{{ item.Description|e }}"{% if not loop.last %}, {% endif %}
        {%- endfor ~%}
      ];
    </script>
    <script src="{{ asset('scripts/hammer.js') }}"></script>
    <script>{% apply minify_js ~%}
      // CSS selectors
      const card = document.querySelector('#card');
      const description = document.querySelector('#description');
      const sacImage = document.querySelector('#image-sac');
      const button = document.querySelector('#button');
      // Hammer.js manager
      const mc = new Hammer(card);
      // return a random item
      function getRandomItem(items) {
        const random = Math.floor(Math.random() * items.length);
        console.log(random, items[random]);
        window.location.hash = random;
        return items[random];
      }
      // update card with the given item key, otherwise random
      function updateCard(item = '') {
        card.classList.replace('bg-secondary', 'bg-white');
        card.classList.replace('text-white', 'text-secondary');
        sacImage.src = '{{ asset('images/sac.svg') }}';
        if (item in items) {
          description.innerHTML = items[item];
        } else {
          description.innerHTML = getRandomItem(items);
        }
      }
      // bump card animation
      function bumpCard() {
        card.style.transform = 'translate(0, -15px)';
        setTimeout(function() {
          card.style.transform = 'translate(0, 0px)';
        }, 500);
        console.log('Card bumped');
      }
      // reset card
      function resetCard() {
        card.classList.replace('bg-white', 'bg-secondary');
        card.classList.replace('text-secondary', 'text-white');
        sacImage.src = '{{ asset('images/sac-nuit.svg') }}';
        description.innerHTML = 'Le sac à dos infini';
        card.style.transform = 'translate(0, 0px)';
      }
      // load item from location hash if exists
      function loadFromHash() {
        itemToLoad = window.location.hash.substring(1);
        if (itemToLoad) {
          console.log('Loading item', itemToLoad);
          updateCard(Number(itemToLoad));
        } else {
          console.log('Reset deck');
          resetCard();
        }
      }
      // update on button click
      button.addEventListener('click', (event) => {
        mc.stop();
        bumpCard();
        updateCard();
      });
      // simulate click on space keyboard press
      document.addEventListener('keydown', (event) => {
        if (event.key === ' ') {
          event.preventDefault();
          button.click();
        }
      });
      // load if hash already exists
      window.addEventListener('load', (event) => {
        loadFromHash();
      });
      // load on hash change
      window.addEventListener('hashchange', (event) => {
        loadFromHash();
      }, false);
      // pan up
      mc.get('pan').set({direction: Hammer.DIRECTION_VERTICAL});
      mc.on('pan', function(ev) {
        card.style.transform = 'translate(0, ' + (ev.deltaY / 10) + 'px)';
      });
      // pan end
      mc.on('panend', function(ev) {
        card.style.transform = 'translate(0, 0px)';
        console.log('deltaY:', ev.deltaY);
        // update on significant pan up, go back on significant pan down
        if (ev.deltaY < -100) {
          updateCard();
        } else if (ev.deltaY > 100) {
          history.back();
        }
      });
    {% endapply %}</script>
    {%- endblock ~%}